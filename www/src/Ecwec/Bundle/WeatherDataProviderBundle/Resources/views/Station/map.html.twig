{% extends 'CoreBundle::layout.html.twig' %}
{% set firstStation = entities|first %}
{% block topjs %}
    <style type="text/css">
        #map-canvas { height: 400px; width: 400px; margin: 10px 0; padding: 0;}
    </style>

    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key={{ map_api_key }}">
    </script>
    <script type="text/javascript">
        function initialize() {
            var mapOptions = {
                center: { lat: {{ firstStation.latitude }}, lng: {{firstStation.longitude }}},
                zoom: 10
            };
            var map = new google.maps.Map(document.getElementById('map-canvas'),
                    mapOptions);

            {% for entity in entities %}
            var marker = new google.maps.Marker({
                position: { lat: {{ entity.latitude }}, lng: {{entity.longitude }}},
                map: map,
                title:"{{ entity.objectId }}",
                url: "{{ path('station_show', {'id' : entity.id}) }}"
            });
            google.maps.event.addListener(marker, 'click', function() {
                window.location.href = this.url;
            });
            {% endfor %}


        }
        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
{% endblock %}

{% block title %}Stations{% endblock %}
{% block content -%}
    <a class="btn btn-primary" href="{{ path('station_new') }}">New</a>
    <div id="map-canvas"></div>
{% endblock %}

{% block bottomjs %}
    <script type="application/javascript">
        function resizeBootstrapMap() {
            var mapParentWidth = $('.container').width();
            var mapContainer = $('#map-canvas');
            mapContainer.width(mapParentWidth);
            mapContainer.height(3 * mapParentWidth / 4);
            google.maps.event.trigger(mapContainer, 'resize');
        }

        // resize the map whenever the window is resized and set the initial size.
        $(window).resize(resizeBootstrapMap);
        $(window).ready(resizeBootstrapMap);
    </script>
{% endblock %}
